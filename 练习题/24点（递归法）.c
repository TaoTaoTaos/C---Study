#include <stdio.h>
#include <stdlib.h>
#include <math.h> // 包含数学库

#include <string.h>

int n = 4;                           
// 定义一个整数n，值为4
int A[4] = {0};                      
// 定义一个长度为4的整数数组A，所有元素初始化为0
char oper[4] = {'+', '-', '*', '/'}; 
// 定义一个长度为4的字符数组oper，存储四种运算符
char B[4][50];                       
// 定义一个二维字符数组B，可以看作是4个长度为50的字符串
int count = 0;                       
// 定义一个整数count，用于计数，初始值为0



/*这个递归函数F的主要目标是找出所有可能的通过加、减、乘、除运算使得四个数字的结果为24的方式。

函数的工作原理如下：

如果n等于1，那么检查A[0]是否等于24。如果是，那么打印B[0]并增加计数器count。
对于n个数，两两组合进行四则运算。这是通过两个嵌套的for循环实现的，其中i和j是数组A的索引。
对于每一对数字a和b（a是A[i]，b是A[j]），执行以下步骤：
执行加法运算a + b，并递归调用函数F(n - 1)。
执行减法运算a - b和b - a，并分别递归调用函数F(n - 1)。
执行乘法运算a * b，并递归调用函数F(n - 1)。
如果b不为0，执行除法运算a / b，并递归调用函数F(n - 1)。
如果a不为0，执行除法运算b / a，并递归调用函数F(n - 1)。
在每次运算后，都会更新A[i]和B[i]的值。A[i]存储运算结果，B[i]存储运算表达式。
在每次运算前后，都会保存和恢复A[i]、A[j]、B[i]、B[j]的值，以确保在每次递归调用中，数组A和B的其他元素不会被改变。
这个函数通过递归的方式枚举了所有可能的运算顺序和运算方式，从而找出所有可能的解。最后，函数F(n)会返回到main()函数中，打印出总共有多少种解法。*/


// 递归函数F，参数为整数n
void F(int n)
{
    // 如果n为1，检查A[0]是否为24，如果是，打印B[0]并增加计数
    if (n == 1)
    {
        if (A[0] == 24)
        {
            printf("%s\n", B[0]);
            count++;
        }
    }
    // 对于n个数，两两组合进行四则运算
    for (int i = 0; i < n; i++)
    {
        for (int j = i + 1; j < n; j++)
        {
            double a, b;            // 定义两个浮点数a和b
            char x[50], y[50];      // 定义两个长度为50的字符串x和y
            a = A[i];               // 将A[i]的值赋给a
            b = A[j];               // 将A[j]的值赋给b
            A[j] = A[n - 1];        // 将A[n-1]的值赋给A[j]
            strcpy(x, B[i]);        // 将B[i]的值复制给x
            strcpy(y, B[j]);        // 将B[j]的值复制给y
            strcpy(B[j], B[n - 1]); // 将B[n-1]的值复制给B[j]

            // 对a和b进行加法运算，并递归调用函数F
            A[i] = a + b;
            sprintf(B[i], "(%s+%s)", x, y);
            F(n - 1);

            // 对a和b进行减法运算，并递归调用函数F
            A[i] = a - b;
            sprintf(B[i], "(%s-%s)", x, y);
            F(n - 1);
            A[i] = b - a;
            sprintf(B[i], "(%s-%s)", y, x);
            F(n - 1);

            // 对a和b进行乘法运算，并递归调用函数F
            A[i] = a * b;
            sprintf(B[i], "(%s*%s)", x, y);
            F(n - 1);

            // 如果b不为0，对a和b进行除法运算，并递归调用函数F
            if (b != 0)
            {
                A[i] = a / b;
                sprintf(B[i], "(%s/%s)", x, y);
                F(n - 1);
            }
            // 如果a不为0，对b和a进行除法运算，并递归调用函数F
            if (a != 0)
            {
                A[i] = b / a;
                sprintf(B[i], "(%s/%s)", y, x);
                F(n - 1);
            }

            // 还原A[i]、A[j]、B[i]、B[j]的值
            A[i] = a;
            A[j] = b;
            strcpy(B[i], x);
            strcpy(B[j], y);
        }
    }
}

// 主函数
int main()
{
    // 打印欢迎信息
    printf("#**************************************#\n");
    printf("#                                      #\n");
    printf("#              欢迎来到                #\n");
    printf("#                                      #\n");
    printf("#             24点小游戏               #\n");
    printf("#                                      #\n");
    printf("#**************************************#\n");

    // 提示用户按回车开始游戏
    printf("请按回车开始游戏：\n");
    getchar();

    // 提示用户输入四个数字
    printf("请输入四个数字（1-13）：\n");
    for (int i = 0; i < 4; ++i)
    {
        scanf("%d", &A[i]); // 读取用户输入的数字并存入数组A
    }
    printf("\n");
    // 将用户输入的数字转换为对应的字符并存入数组B
    for (int i = 0; i < 4; i++)
    {
        if (A[i] == 1)
            strcpy(B[i], "A");
        else if (A[i] == 11)
            strcpy(B[i], "J");
        else if (A[i] == 12)
            strcpy(B[i], "Q");
        else if (A[i] == 13)
            strcpy(B[i], "K");
        else
            sprintf(B[i], "%d", A[i]);
    }
    // 调用函数F，参数为n
    F(n);
    // 打印总共有多少种解法
    printf("\n总共有 %d 种解法\n", count);
    return 0; // 主函数返回0
}
